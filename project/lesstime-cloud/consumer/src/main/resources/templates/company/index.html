<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>扫码点餐系统-企业首页</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="/layui/layui.js"></script>
    <!--<script src="/js/isQyLogin.js"></script>-->
    <link rel="stylesheet" href="/css/tab-style.css">
    <style type="text/css">
        .table .layui-card-body {
            height: 250px;
            overflow-y: scroll;
        }
        .table .layui-card-body::-webkit-scrollbar {display:none}；
    </style>
</head>
<body class="layui-bg-gray" style="padding:10px">
<div class="layui-fluid">
    <div class="layui-row layui-col-space15" id="content">
        <div class="layui-col-md3">
            <div class="layui-card table">
                <div class="layui-card-header">
                    餐桌
                    <span class="czbh">cz-sj20190305001-1</span>
                    <span class="layui-badge">已占坐</span>
                    <i class="layui-icon layui-icon-ok check" style="float:right;cursor:pointer"> 结账</i>
                </div>
                <div class="layui-card-body">
                    <table class="layui-table" lay-even lay-skin="row">
                        <tbody>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        <tr>
                            <td>肥牛</td>
                            <td>4份</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="layui-card table">
                <div class="layui-card-header">
                    餐桌
                    <span class="czbh">cz-sj20190305001-1</span>
                    <span class="layui-badge">已占坐</span>
                    <i class="layui-icon layui-icon-ok check" style="float:right;cursor:pointer"> 结账</i>
                </div>
                <div class="layui-card-body">
                    <table class="layui-table" lay-even lay-skin="row">
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['layer'], function() {
        var layer = layui.layer;

        var sjbh = localStorage.getItem("sjbh");
        var data = {
            sjbh: sjbh
        };

        var alreadyUseTable = new Array();

        var index = layer.load(1);
        $.ajax({
            url: "/handle/table/list",
            type: "get",
            contentType: "application/json;charset=UTF-8",
            data: { sjbh: sjbh, page: 1, limit: 1000},
            dataType: 'json',
            timeout: 20000,
            success: function (response) {
                console.log(response);
                var dataList = response.data;
                for(var i = 0; i < dataList.length; i++) {
                    addTable(dataList[i].czbh, dataList[i].czzt);
                    if(dataList[i].czzt == 1) {
                        alreadyUseTable.push(dataList[i].czbh);
                    }
                }
                console.log(alreadyUseTable);
            },
            error: function(response) {
                console.log(response);
            },
            complete: function() {
                for(var i = 0; i < alreadyUseTable.length; i++) {
                    var ddData = {
                        czbh: alreadyUseTable[i],
                        ddzt: 2
                    };
                    $.ajax({
                        url: "/handle/order/company/index",
                        type: "post",
                        contentType: "application/json;charset=UTF-8",
                        data: JSON.stringify(ddData),
                        dataType: 'json',
                        timeout: 20000,
                        success: function (response) {
                            console.log(response);
                            layer.close(index);
                            var cpList = response.cpList;
                            for(var i = cpList.length-1; i >= 0; i--) {

                            }
                        }
                    })
                }
            }
        })
    });

    //在页面上增加table
    function addTable(czbh, czzt) {
        var table = "<div class=\"layui-col-md3\">\n" +
            "            <div class=\"layui-card table\">\n" +
            "                <div class=\"layui-card-header\">\n" +
            "                    餐桌\n" +
            "                    <span class=\"czbh\">" + czbh + "</span>\n" +
            "                    <span class=\"layui-badge CZZTCLASS\">CZZT</span>\n" +
            "                    <i class=\"layui-icon layui-icon-ok check\" style=\"float:right;cursor:pointer\"> 结账</i>\n" +
            "                </div>\n" +
            "                <div class=\"layui-card-body\">\n" +
            "                    <table class=\"layui-table\" lay-even lay-skin=\"row\">\n" +
            "                        <tbody id='" + czbh + "'></tbody>\n" +
            "                    </table>\n" +
            "                </div>\n" +
            "            </div>\n" +
            "        </div>";
        if(czzt == 0) {
            table = table.replace("CZZTCLASS", "layui-bg-blue");
            table = table.replace("CZZT", "未占座");
        } else if(czzt == 1) {
            table = table.replace("CZZTCLASS", "");
            table = table.replace("CZZT", "已占座");
        }

        $("#content").append(table);
    }
</script>
</body>
</html>